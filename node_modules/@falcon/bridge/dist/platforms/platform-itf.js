/*! For license information please see platform-itf.js.LICENSE.txt */
"use strict";(self.webpackChunkfalcon=self.webpackChunkfalcon||[]).push([["platforms/platform-itf"],{"./src/platforms/platform-itf.ts":function(e,t,n){n.r(t),n.d(t,{EGameMode:function(){return a},EHeader:function(){return o},EItgBetMode:function(){return s},EMediaTypes:function(){return i},EPath:function(){return r}});var a,i,r,o,s,c=n("./node_modules/axios/index.js"),u=n.n(c),d=n("./src/tools/token-store.ts"),l=n("./src/tools/tools.ts"),h=function(e,t,n,a){return new(n||(n=Promise))((function(i,r){function o(e){try{c(a.next(e))}catch(e){r(e)}}function s(e){try{c(a.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((a=a.apply(e,t||[])).next())}))},p=function(e,t){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(i=2&r[0]?a.return:r[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,a=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],a=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}};!function(e){e.demo="DEMO",e.normal="NORMAL"}(a||(a={})),function(e){e.ERROR="application/vnd.lotsys.falcon.error-1+json",e.REPLAYTOKEN="application/vnd.lotsys.falcon.gateway.replayprotection.token-1+json",e.SESSIONCREATE="application/vnd.lotsys.itf.session.request-1+json",e.CATALOG="application/vnd.fgs.itf.catalog.game.list-5+json",e.COMPATIBILITY="application/vnd.fgs.itf.catalog.unauthenticated.lottery.games.compatibility-1+json",e.USERDATAREQUEST="application/vnd.lotsys.itf.game.userdata.search.parameters-1+json",e.USERDATARESPONSE="application/vnd.lotsys.itf.game.userdata-1+json",e.JACKPOT="application/vnd.lotsys.itf.jackpot-1+json",e.GAMEMODEL="application/vnd.lotsys.itf.game.model-1+json",e.GAMESESSIONS="application/vnd.lotsys.itf.game.session.list-1+json",e.GAMESESSIONSPARAMETERS="application/vnd.lotsys.itf.game.session.search.parameters-1+json",e.BETREQUEST="application/vnd.lotsys.itf.game.bet.request-1+json",e.BETRESULT="application/vnd.lotsys.itf.game.bet.result-1+json",e.GAMIFCONTEXT="application/vnd.lotsys.itf.gamification.context-1+json",e.BETANDCLAIM="application/vnd.lotsys.itg.ticket.betManualClaim-1+json",e.AUTOCLAIM="application/vnd.lotsys.itg.ticket.betAutoClaim-1+json",e.TICKETSLIST="application/vnd.lotsys.itf.game.ticket.list-1+json",e.TICKETSLIST2="application/vnd.lotsys.itf.game.ticket.list-2+json",e.TICKETSLIST3="application/vnd.lotsys.itf.game.ticket.list-3+json",e.GETSTATE="application/vnd.lotsys.itf.session.state.info-1+json",e.GAMECONFIGURATION="application/vnd.fgs.itf.catalog.unauthenticated.lotterygame.config.map-1+json",e.PURSE="application/vnd.fgs.itf.virtualcurrency.purse.list-1+json",e.MTP_GETROOMS="application/vnd.lotsys.itf.game.room.list-1+json",e.MTP_GETROOM="application/vnd.lotsys.itf.game.room-1+json",e.MTP_GETSESSION="application/vnd.lotsys.itf.game.session-1+json",e.MTP_ENTERANDBET_REQUEST="application/vnd.lotsys.itf.game.enter.bet.request-1+json",e.MTP_ENTERROOM_RESULT="application/vnd.lotsys.itf.game.enter.result-1+json",e.MTP_ENTERROOM_REQUEST="application/vnd.lotsys.itf.game.enter.request-1+json",e.PRS_TICKET_INFOS="application/vnd.fgs.itf.presto.ticket-1+json"}(i||(i={})),function(e){e.REPLAYPROTECTION="/falcon/gateway/replayprotectiontokens",e.USERDATA="/itf/game/userdata",e.ITFSESSION="/itf/session",e.GAMES="/itf/catalog/games/lotteries",e.JACKPOT="/itf/jackpot/lotteries",e.GAMEMODEL="/itf/game/model",e.GAMECONFIGURATION="/itf/catalog-unauthenticated/lotteries",e.GAMESESSIONS="/itf/game/sessions",e.BET="/itf/game/bet",e.GAMIFCONTEXT="/itf/gamif/games",e.GETITGTICKETS="/itf/game/ITG/tickets",e.PURSE="/itf/virtual-currency-purse/lotteries",e.MTP_ROOMS="/itf/game/MTP/rooms",e.MTP_ENTER="/itf/game/enter",e.MTP_ENTERANDBET="/itf/game/enter/bet",e.MTP_SESSION="/itf/game/session/room",e.WIZZ_AVATAR="/avatar"}(r||(r={})),function(e){e.CONTENTTYPE="Content-Type",e.ACCEPT="Accept",e.TOKEN="replay-token",e.ASK_TOKEN="replay-token-generate",e.GENERATED_TOKEN="replay-token-generated",e.CORRELATION_ID="correlation-id"}(o||(o={})),function(e){e.AUTO="BET_AUTO_CLAIM",e.MANUAL="BET_MANUAL_CLAIM"}(s||(s={}));var m=0,T=function(){function e(e){var t=this;this.bridge=e,this.ticketsMap={},this.masksMap={},this._configuration=e.configuration,this._tokens=new d.TokenStore((function(){return t.getReplayProtectionToken()})),this._request=u().create({baseURL:this._configuration.paths.applications.ITF}),this._request.interceptors.request.use((function(e){return e.headers[t._configuration.correlationIdHeaderName?t._configuration.correlationIdHeaderName:o.CORRELATION_ID]=t.bridge.getCorrelationId(),t.bridge.channel.emitRequestParamsTag(e),e})),this._request.interceptors.response.use((function(e){return t.bridge.channel.emitRequestResponseTag(e.config,e),e}),(function(e){return t._handleResponseErrors(e)})),this._requestWithToken=u().create({baseURL:this._configuration.paths.applications.ITF}),this._requestWithToken.interceptors.request.use((function(e){return h(t,void 0,void 0,(function(){var t,n;return p(this,(function(a){switch(a.label){case 0:return e.headers[o.ASK_TOKEN]=!0,t=e.headers,n=o.TOKEN,[4,this._tokens.get()];case 1:return t[n]=a.sent(),e.headers[this._configuration.correlationIdHeaderName?this._configuration.correlationIdHeaderName:o.CORRELATION_ID]=this.bridge.getCorrelationId(),this.bridge.channel.emitRequestParamsTag(e),[2,e]}}))}))}),(function(e){throw e})),this._requestWithToken.interceptors.response.use((function(e){return e&&e.headers&&e.headers[o.GENERATED_TOKEN]&&t._tokens.add(e.headers[o.GENERATED_TOKEN]),t.bridge.channel.emitRequestResponseTag(e.config,e),e}),(function(e){return t._handleResponseErrors(e)}))}return e.prototype.getReplayProtectionToken=function(){return h(this,void 0,void 0,(function(){var e,t;return p(this,(function(n){switch(n.label){case 0:return e={method:"post",data:{},url:r.REPLAYPROTECTION,eventTag:"getReplayProtectionToken",headers:(t={},t[o.ACCEPT]=i.REPLAYTOKEN,t)},[4,this._request.request(e)];case 1:return[2,n.sent().data.value]}}))}))},e.prototype.getState=function(e){return h(this,void 0,void 0,(function(){var t,n,a;return p(this,(function(r){switch(r.label){case 0:return e=e||this.bridge.channel.lotteryCode,t={method:"get",url:"/itf/session/state?lottery=".concat(e),eventTag:"getState",headers:(a={},a[o.CONTENTTYPE]=i.GETSTATE,a)},[4,this._request.request(t)];case 1:return(n=r.sent().data)&&n.redirectUrl&&this.bridge.getOpenGameParameters().lotteryChannel&&(n.redirectUrl+="&channel="+this.bridge.getOpenGameParameters().lotteryChannel),[2,n]}}))}))},e.prototype.createSession=function(e,t){return void 0===t&&(t=!1),h(this,void 0,void 0,(function(){var n,a,s;return p(this,(function(c){switch(c.label){case 0:return e=e||{provider:this.bridge.channel.lotteryCode,state:"dummy_state",value:"dummy_value"},n={demoMode:t,lottery:e.provider,state:e.state,token:e.value},this.bridge.getOpenGameParameters().lotteryChannel&&(n.channel=this.bridge.getOpenGameParameters().lotteryChannel),a={method:"post",url:r.ITFSESSION,data:n,eventTag:"createSession",headers:(s={},s[o.CONTENTTYPE]=i.SESSIONCREATE,s)},[4,this._request.request(a)];case 1:return[2,c.sent().data]}}))}))},e.prototype.getCurrentGameConfig=function(e,t){return h(this,void 0,void 0,(function(){var n,a,s;return p(this,(function(c){switch(c.label){case 0:return e||(e=this.bridge.channel.lotteryCode),t||(t={applicationId:this.bridge.channel.type,serviceName:this.bridge.channel.name}),a={method:"get",url:"".concat(r.GAMECONFIGURATION,"/").concat(e,"/games/").concat(t.serviceName,"/config"),eventTag:"getCurrentGameConfig",headers:(s={},s[o.ACCEPT]=i.GAMECONFIGURATION,s)},[4,this._request.request(a)];case 1:return"string"==typeof(n=c.sent().data).stakes&&(n.stakes=JSON.parse(n.stakes)),[2,n]}}))}))},e.prototype.getCompatibility=function(e){return h(this,void 0,void 0,(function(){var t,n,a;return p(this,(function(s){switch(s.label){case 0:return t=this.bridge.channel.lotteryCode,e=e||this.bridge.channel.name,n={method:"get",url:"".concat(r.GAMECONFIGURATION,"/").concat(t,"/compatibility?gameCodes=").concat(e),eventTag:"getCompatibility",headers:(a={},a[o.ACCEPT]=i.COMPATIBILITY,a)},[4,this._request.request(n)];case 1:return[2,s.sent().data.gamesCompatibility||[]]}}))}))},e.prototype.getGames=function(e){return h(this,void 0,void 0,(function(){var t,n;return p(this,(function(a){switch(a.label){case 0:return e=e||this.bridge.channel.lotteryCode,t={method:"get",url:"".concat(r.GAMES,"/").concat(e),eventTag:"getGames",headers:(n={},n[o.ACCEPT]=i.CATALOG,n)},[4,this._request.request(t)];case 1:return[2,a.sent().data||[]]}}))}))},e.prototype.getPlayersInfo=function(e,t){return h(this,void 0,void 0,(function(){var n;return p(this,(function(a){switch(a.label){case 0:return t=t||this.bridge.channel.lotteryCode,n={method:"get",eventTag:"getPlayersInfo",url:"/itf/players/lotteries/".concat(t,"/players?").concat(e.map((function(e){return"playerIds="+e})).join("&"))},[4,this._request.request(n)];case 1:return[2,a.sent().data]}}))}))},e.prototype.getCurrentPlayerInfo=function(e){return h(this,void 0,void 0,(function(){var t;return p(this,(function(n){switch(n.label){case 0:return e=e||this.bridge.channel.lotteryCode,t={method:"get",eventTag:"getCurrentPlayerInfo",url:"/itf/players/lotteries/".concat(e,"/players/current")},[4,this._request.request(t)];case 1:return[2,n.sent().data]}}))}))},e.prototype.getPlayerCurrency=function(e,t,n,a){return h(this,void 0,void 0,(function(){var s,c,u;return p(this,(function(d){switch(d.label){case 0:return a=a||this.bridge.channel.lotteryCode,s=n&&n.serviceName||this.bridge.channel.name,c={method:"get",eventTag:"getPlayerCurrency",url:"".concat(r.PURSE,"/").concat(a,"/players/").concat(t,"/purses?currency=").concat(e,"&serviceName=").concat(s),headers:(u={},u[o.ACCEPT]=i.PURSE,u)},[4,this._request.request(c)];case 1:return[2,d.sent().data]}}))}))},e.prototype.getAvatarUrl=function(e){return"".concat(this._configuration.paths.media).concat(r.WIZZ_AVATAR,"/").concat(e,".png")},e.prototype.getJackpotInformation=function(e){return void 0===e&&(e={}),h(this,void 0,void 0,(function(){var t,n,a;return p(this,(function(s){switch(s.label){case 0:return t=e.serviceName||this.bridge.channel.name,n={method:"get",eventTag:"getJackpotInformation",url:"".concat(r.JACKPOT,"/").concat(this.bridge.channel.lotteryCode,"/games/").concat(t,"/jackpots"),headers:(a={},a[o.ACCEPT]=i.JACKPOT,a)},[4,this._request.request(n)];case 1:return[2,s.sent().data]}}))}))},e.prototype.getJackpotConfiguration=function(e){return h(this,void 0,void 0,(function(){return p(this,(function(t){switch(t.label){case 0:return[4,this._request.get("/jackpots/".concat(e))];case 1:return[2,t.sent().data]}}))}))},e.prototype.getItgModel=function(e){return h(this,void 0,void 0,(function(){var t,n;return p(this,(function(a){switch(a.label){case 0:return e=e||this.bridge.channel.name,t={method:"get",eventTag:"getItgModel",url:"/itf/game/model/ITG/".concat(e),headers:(n={},n[o.ACCEPT]=i.GAMEMODEL,n)},[4,this._request.request(t)];case 1:return[2,a.sent().data]}}))}))},e.prototype.getItgTicket=function(e,t){return void 0===t&&(t=!1),h(this,void 0,void 0,(function(){var n,r,s,c,u;return p(this,(function(d){switch(d.label){case 0:return n=t?a.demo:a.normal,[4,this.bridge.updateGameMode(n)];case 1:return d.sent(),r={method:"get",eventTag:"getItgTicket",url:"/itf/game/ITG/tickets?demoMode=".concat(t,"&filter.engineHistoryId=").concat(e),headers:(u={},u[o.ACCEPT]=i.TICKETSLIST,u)},[4,this._requestWithToken.request(r)];case 2:if((s=d.sent().data).length>0){if((c=s[0]).serviceName!==this.bridge.channel.name)throw{code:"mismatch-game-code"};return[2,c]}return[2,null]}}))}))},e.prototype.getItgTickets=function(e,t){return void 0===t&&(t=!1),h(this,void 0,void 0,(function(){var n,r,s;return p(this,(function(c){switch(c.label){case 0:return[4,this._itgBetMediaType()];case 1:return c.sent()!==i.BETANDCLAIM?[2,[]]:(e=e||this.bridge.channel.name,n=t?a.demo:a.normal,[4,this.bridge.updateGameMode(n)]);case 2:return c.sent(),r={method:"get",eventTag:"getItgTickets",url:"/itf/game/ITG/tickets?demoMode=".concat(t,"&filter.ticketStatus=OPENED&filter.gameCode=").concat(e),headers:(s={},s[o.ACCEPT]=i.TICKETSLIST,s)},[4,this._requestWithToken.request(r)];case 3:return[2,c.sent().data]}}))}))},e.prototype.createITGBet=function(e){return h(this,void 0,void 0,(function(){var t,n,s,c,u,d,l,h,T;return p(this,(function(p){switch(p.label){case 0:return this._isMultiBet()?[2,new Promise((function(e){}))]:[4,this._itgBetMediaType()];case 1:return t=p.sent(),n=e.applicationId||this.bridge.channel.type,s=e.serviceName||this.bridge.channel.name,c={applicationId:n,serviceName:s,mediaType:t,stake:e.stake,data:e.revelationData||e.eventReference?{revelationData:e.revelationData,eventReference:e.eventReference}:void 0},[4,this.bridge.updateGameMode(e.demo?a.demo:a.normal)];case 2:return p.sent(),u={method:"post",data:c,url:"".concat(r.BET,"?demoMode=").concat(Boolean(e.demo)),eventTag:"createITGBet",headers:(T={},T[o.CONTENTTYPE]=i.BETREQUEST,T[o.ACCEPT]=i.BETRESULT,T),extraTagData:{response:{gameCount:++m}}},[4,this._requestWithToken.request(u)];case 3:return(d=p.sent().data).jackpotResult&&d.jackpotResult.wonAmount.value>0?[4,this.bridge.displayJackpotRevelation(d.jackpotResult)]:[3,5];case 4:p.sent(),p.label=5;case 5:return t===i.BETANDCLAIM?[3,7]:(delete(l=JSON.parse(JSON.stringify(d))).message,[4,this.bridge.channel.maskPurse({betAmount:e.stake,purseInformation:null,winAmount:l.wonAmount})]);case 6:h=p.sent(),this.bridge.displayedAmount=h,this.masksMap[d.data.id]=h.maskId,this.ticketsMap[d.data.id]=l,p.label=7;case 7:return this.bridge.emitEvent("HAS_BET",d),[2,d]}}))}))},e.prototype.updateItgBet=function(e,t){return h(this,void 0,void 0,(function(){var n,s,c,u,d;return p(this,(function(l){switch(l.label){case 0:return[4,this._itgBetMediaType()];case 1:return l.sent()!==i.BETANDCLAIM?[2,this.ticketsMap[t]]:[4,this.bridge.updateGameMode(e.demo?a.demo:a.normal)];case 2:return l.sent(),n=e.applicationId||this.bridge.channel.type,s=e.serviceName||this.bridge.channel.name,c={applicationId:n,serviceName:s,stake:e.stake,data:{id:t,revelationData:e.revelationData}},u={method:"put",data:c,url:"".concat(r.BET,"?demoMode=").concat(Boolean(e.demo)),eventTag:"updateItgBet",headers:(d={},d[o.CONTENTTYPE]=i.BETREQUEST,d[o.ACCEPT]=i.BETRESULT,d)},[4,this._requestWithToken.request(u)];case 3:return[2,l.sent().data]}}))}))},e.prototype.claimItgBet=function(e,t){return h(this,void 0,void 0,(function(){var n,s,c,u,d,l,h;return p(this,(function(p){switch(p.label){case 0:return[4,this._itgBetMediaType()];case 1:return p.sent()===i.BETANDCLAIM?[3,3]:(n=this.ticketsMap[t],[4,this.bridge.channel.clearPurse(this.masksMap[t])]);case 2:if(p.sent(),this.bridge.displayedAmount=null,delete this.masksMap[t],delete this.ticketsMap[t],this.bridge.emitEvent("HAS_CLAIMED",n),n&&n.wonAmount)return this.bridge.emitEvent("TAG",{eventType:"bet",event:n.wonAmount.value>0?"betWin":"betLoose",amount:n.wonAmount}),[2,n];p.label=3;case 3:return[4,this.bridge.updateGameMode(e.demo?a.demo:a.normal)];case 4:return p.sent(),s=e.applicationId||this.bridge.channel.type,c=e.serviceName||this.bridge.channel.name,u={applicationId:s,serviceName:c,stake:e.stake,data:{id:t,revelationData:e.revelationData,status:"CLAIMED"}},d={method:"put",data:u,url:"".concat(r.BET,"?demoMode=").concat(Boolean(e.demo)),eventTag:"claimItgBet",headers:(h={},h[o.CONTENTTYPE]=i.BETREQUEST,h[o.ACCEPT]=i.BETRESULT,h)},[4,this._requestWithToken.request(d)];case 5:return l=p.sent().data,this.bridge.emitEvent("HAS_CLAIMED",l),[2,l]}}))}))},e.prototype.getEinModel=function(e,t){return void 0===t&&(t=!1),h(this,void 0,void 0,(function(){var n,r;return p(this,(function(s){switch(s.label){case 0:return[4,this.bridge.updateGameMode(t?a.demo:a.normal)];case 1:return s.sent(),e=e||this.bridge.channel.name,n={method:"get",eventTag:"getEinModel",url:"/itf/game/model/EIN/".concat(e,"?demoMode=").concat(t),headers:(r={},r[o.ACCEPT]=i.GAMEMODEL,r)},[4,this._request.request(n)];case 2:return[2,s.sent().data]}}))}))},e.prototype.getEinTicket=function(e,t){return void 0===t&&(t=!1),h(this,void 0,void 0,(function(){var n,r,s;return p(this,(function(c){switch(c.label){case 0:return[4,this.bridge.updateGameMode(t?a.demo:a.normal)];case 1:return c.sent(),n={method:"get",eventTag:"getEinTicket",url:"/itf/game/EIN/tickets?demoMode=".concat(t,"&filter.engineHistoryId=").concat(e),headers:(s={},s[o.ACCEPT]=i.TICKETSLIST3,s)},[4,this._requestWithToken.request(n)];case 2:return[2,(r=c.sent().data).length?r[0]:null]}}))}))},e.prototype.getEinTickets=function(e,t){return void 0===t&&(t=!1),h(this,void 0,void 0,(function(){var n,r;return p(this,(function(s){switch(s.label){case 0:return[4,this._itgBetMediaType()];case 1:return"application/vnd.fgs.instant.ticket.betManualClaim-1+json"!==s.sent()?[2,[]]:[4,this.bridge.updateGameMode(t?a.demo:a.normal)];case 2:return s.sent(),e=e||this.bridge.channel.name,n={method:"get",eventTag:"getEinTickets",url:"/itf/game/EIN/tickets?demoMode=".concat(t,"&filter.ticketStatus=DRAWN&filter.gameCode=").concat(e),headers:(r={},r[o.ACCEPT]=i.TICKETSLIST3,r)},[4,this._requestWithToken.request(n)];case 3:return[2,s.sent().data]}}))}))},e.prototype.createEinBet=function(e){return h(this,void 0,void 0,(function(){var t,n,s,c,u,d;return p(this,(function(l){switch(l.label){case 0:return this._isMultiBet()?[2,new Promise((function(){}))]:[4,this.bridge.updateGameMode(e.demo?a.demo:a.normal)];case 1:return l.sent(),t=e.applicationId||this.bridge.channel.type,n=e.serviceName||this.bridge.channel.name,s={applicationId:t,serviceName:n,mediaType:"application/vnd.fgs.instant.ticket.betManualClaim-1+json",stake:e.stake,data:{gameClientData:e.gameClientData}},c={method:"post",data:s,url:"".concat(r.BET,"?demoMode=").concat(Boolean(e.demo)),eventTag:"createEinBet",headers:(d={},d[o.CONTENTTYPE]=i.BETREQUEST,d[o.ACCEPT]=i.BETRESULT,d),extraTagData:{response:{gameCount:++m}}},[4,this._requestWithToken.request(c)];case 2:return u=l.sent().data,this.bridge.emitEvent("HAS_BET",u),[2,u]}}))}))},e.prototype.updateEinBet=function(e,t){return h(this,void 0,void 0,(function(){var n,s,c,u,d;return p(this,(function(l){switch(l.label){case 0:return[4,this._itgBetMediaType()];case 1:return"application/vnd.fgs.instant.ticket.betManualClaim-1+json"!==l.sent()?[2,this.ticketsMap[t]]:[4,this.bridge.updateGameMode(e.demo?a.demo:a.normal)];case 2:return l.sent(),n=e.applicationId||this.bridge.channel.type,s=e.serviceName||this.bridge.channel.name,c={applicationId:n,serviceName:s,stake:e.stake,mediaType:"application/vnd.fgs.instant.ticket.betManualClaim-1+json",data:{id:t,gameClientData:e.gameClientData}},u={method:"put",data:c,url:"".concat(r.BET,"?demoMode=").concat(Boolean(e.demo)),eventTag:"updateEinBet",headers:(d={},d[o.CONTENTTYPE]=i.BETREQUEST,d[o.ACCEPT]=i.BETRESULT,d)},[4,this._requestWithToken.request(u)];case 3:return[2,l.sent().data]}}))}))},e.prototype.claimEinBet=function(e,t){return h(this,void 0,void 0,(function(){var n,s,c,u,d,l,h;return p(this,(function(p){switch(p.label){case 0:return[4,this._itgBetMediaType()];case 1:return"application/vnd.fgs.instant.ticket.betManualClaim-1+json"===p.sent()?[3,4]:(n=this.ticketsMap[t])?[4,this.bridge.channel.clearPurse(this.masksMap[t])]:[3,3];case 2:p.sent(),this.bridge.displayedAmount=null,delete this.masksMap[t],delete this.ticketsMap[t],this.bridge.emitEvent("HAS_CLAIMED",n),p.label=3;case 3:return[2,n];case 4:return[4,this.bridge.updateGameMode(e.demo?a.demo:a.normal)];case 5:return p.sent(),s=e.applicationId||this.bridge.channel.type,c=e.serviceName||this.bridge.channel.name,u={applicationId:s,serviceName:c,stake:e.stake,mediaType:"application/vnd.fgs.instant.ticket.betManualClaim-1+json",data:{id:t,gameClientData:e.gameClientData,status:"CLAIMED"}},d={method:"put",data:u,url:"".concat(r.BET,"?demoMode=").concat(Boolean(e.demo)),eventTag:"claimEinBet",headers:(h={},h[o.CONTENTTYPE]=i.BETREQUEST,h[o.ACCEPT]=i.BETRESULT,h)},[4,this._requestWithToken.request(d)];case 6:return l=p.sent().data,this.bridge.emitEvent("HAS_CLAIMED",l),[2,l]}}))}))},e.prototype.getMtrModel=function(e,t){return void 0===t&&(t=!1),h(this,void 0,void 0,(function(){var n,s,c,u;return p(this,(function(d){switch(d.label){case 0:return[4,this.bridge.updateGameMode(t?a.demo:a.normal)];case 1:return d.sent(),n=e.applicationId||this.bridge.channel.type,s=e.serviceName||this.bridge.channel.name,c={method:"get",url:"".concat(r.GAMEMODEL,"/").concat(n,"/").concat(s,"?demoMode=").concat(t),eventTag:"getMtrModel",headers:(u={},u[o.ACCEPT]=i.GAMEMODEL,u)},[4,this._request.request(c)];case 2:return[2,d.sent().data]}}))}))},e.prototype.getMtrSession=function(e,t,n){return h(this,void 0,void 0,(function(){var s,c,u,d;return p(this,(function(l){switch(l.label){case 0:return[4,this.bridge.updateGameMode(t?a.demo:a.normal)];case 1:return l.sent(),s=["applicationId=".concat(e.applicationId||this.bridge.channel.type),"serviceName=".concat(e.serviceName||this.bridge.channel.name),"demoMode=".concat(t||!1)],n&&s.push("gameSessionId=".concat(n)),c={method:"get",url:"".concat(r.GAMESESSIONS,"?").concat(s.join("&")),eventTag:"getMtrSession",headers:(d={},d[o.ACCEPT]=i.GAMESESSIONS,d[o.CONTENTTYPE]=i.GAMESESSIONSPARAMETERS,d)},[4,this._request.request(c)];case 2:return(u=l.sent().data)&&u.length?[2,u[0]]:[2,void 0]}}))}))},e.prototype.createMtrBet=function(e){return h(this,void 0,void 0,(function(){var t,n,s,c,u,d,l;return p(this,(function(h){switch(h.label){case 0:return this._isMultiBet()?[2,new Promise((function(e){}))]:(t=void 0!==e.demo&&e.demo,[4,this.bridge.updateGameMode(t?a.demo:a.normal)]);case 1:return h.sent(),n=e.applicationId||this.bridge.channel.type,s=e.serviceName||this.bridge.channel.name,c={applicationId:n,serviceName:s,stake:e.stake,data:e.parameters},u={method:"post",url:"".concat(r.BET,"?demoMode=").concat(t),eventTag:"createMtrBet",data:c,headers:(l={},l[o.CONTENTTYPE]=i.BETREQUEST,l[o.ACCEPT]=i.BETRESULT,l),extraTagData:{response:{gameCount:++m}}},[4,this._requestWithToken.request(u)];case 2:return(d=h.sent().data).data.data.id=d.data.data.id.toString(),this.bridge.emitEvent("HAS_BET",d),[2,d]}}))}))},e.prototype.updateMtrBet=function(e){return h(this,void 0,void 0,(function(){var t,n,s,c,u,d,l;return p(this,(function(h){switch(h.label){case 0:return t=void 0!==e.demo&&e.demo,[4,this.bridge.updateGameMode(t?a.demo:a.normal)];case 1:return h.sent(),n=e.applicationId||this.bridge.channel.type,s=e.serviceName||this.bridge.channel.name,c={applicationId:n,serviceName:s,data:e.parameters},u={method:"put",url:"".concat(r.BET,"?demoMode=").concat(t),eventTag:"updateMtrBet",data:c,headers:(l={},l[o.CONTENTTYPE]=i.BETREQUEST,l[o.ACCEPT]=i.BETRESULT,l)},[4,this._requestWithToken.request(u)];case 2:return(d=h.sent().data).data.data.id=d.data.data.id.toString(),d.wonAmount&&this.bridge.emitEvent("HAS_CLAIMED",d),[2,d]}}))}))},e.prototype.getPrsTicketInfos=function(){return h(this,void 0,void 0,(function(){var e;return p(this,(function(t){switch(t.label){case 0:return[4,this._request.request({method:"get",url:"/itf/game/presto/ticket",eventTag:"gePrsTicketInfos",headers:(e={},e[o.ACCEPT]=i.PRS_TICKET_INFOS,e)})];case 1:return[2,t.sent().data]}}))}))},e.prototype.getGamifContext=function(e){return h(this,void 0,void 0,(function(){var t,n,a;return p(this,(function(s){switch(s.label){case 0:return e.applicationId||this.bridge.channel.type,t=e.serviceName||this.bridge.channel.name,n={method:"get",url:"".concat(r.GAMIFCONTEXT,"/").concat(t),eventTag:"getGamifContext",headers:(a={},a[o.CONTENTTYPE]=i.GAMIFCONTEXT,a)},[4,this._request.request(n)];case 1:return[2,s.sent().data]}}))}))},e.prototype.getMtpModel=function(e,t){return h(this,void 0,void 0,(function(){var n,s,c,u;return p(this,(function(d){switch(d.label){case 0:return[4,this.bridge.updateGameMode(t?a.demo:a.normal)];case 1:return d.sent(),n=e.applicationId||this.bridge.channel.type,s=e.serviceName||this.bridge.channel.name,c={method:"get",url:"".concat(r.GAMEMODEL,"/").concat(n,"/").concat(s,"?demoMode=").concat(Boolean(t)),eventTag:"getMtpModel",headers:(u={},u[o.ACCEPT]=i.GAMEMODEL,u)},[4,this._request.request(c)];case 2:return[2,d.sent().data]}}))}))},e.prototype.getMtpRoom=function(e,t,n){return h(this,void 0,void 0,(function(){var r,s,c,u;return p(this,(function(d){switch(d.label){case 0:return[4,this.bridge.updateGameMode(n?a.demo:a.normal)];case 1:return d.sent(),r=e.applicationId||this.bridge.channel.type,s=e.serviceName||this.bridge.channel.name,c={method:"get",url:"itf/game/".concat(r,"/").concat(s,"/rooms/").concat(t,"?demoMode=").concat(Boolean(n)),eventTag:"getMtpRoom",headers:(u={},u[o.ACCEPT]=i.MTP_GETROOM,u)},[4,this._request.request(c)];case 2:return[2,d.sent().data]}}))}))},e.prototype.getMtpRooms=function(e,t){return h(this,void 0,void 0,(function(){var n,s,c;return p(this,(function(u){switch(u.label){case 0:return[4,this.bridge.updateGameMode(t?a.demo:a.normal)];case 1:return u.sent(),n=e.serviceName||this.bridge.channel.name,s={method:"get",url:"".concat(r.MTP_ROOMS,"?demoMode=").concat(Boolean(t)),eventTag:"getMtpRooms",headers:(c={},c[o.ACCEPT]=i.MTP_GETROOMS,c)},[4,this._request.request(s)];case 2:return[2,u.sent().data.filter((function(e){return e.serviceName===n}))]}}))}))},e.prototype.getMtpSession=function(e,t,n){return h(this,void 0,void 0,(function(){var s,c,u,d;return p(this,(function(l){switch(l.label){case 0:return[4,this.bridge.updateGameMode(n?a.demo:a.normal)];case 1:return l.sent(),s=e.applicationId||this.bridge.channel.type,c=e.serviceName||this.bridge.channel.name,u={method:"get",url:"".concat(r.MTP_SESSION,"?applicationId=").concat(s,"&serviceName=").concat(c,"&roomId=").concat(t,"&demoMode=").concat(Boolean(n)),eventTag:"getMtpSession",headers:(d={},d[o.ACCEPT]=i.MTP_GETSESSION,d)},[4,this._request.request(u)];case 2:return[2,l.sent().data]}}))}))},e.prototype.enterMtpRoom=function(e,t){return h(this,void 0,void 0,(function(){var n,s,c,u,d;return p(this,(function(l){switch(l.label){case 0:return[4,this.bridge.updateGameMode(t?a.demo:a.normal)];case 1:return l.sent(),n=e.applicationId||this.bridge.channel.type,s=e.serviceName||this.bridge.channel.name,c={applicationId:n,serviceName:s,roomCriteria:{betLevelId:e.betLevelId}},u={method:"post",url:"".concat(r.MTP_ENTER,"?demoMode=").concat(Boolean(t)),eventTag:"enterMtpRoom",data:c,headers:(d={},d[o.CONTENTTYPE]=i.MTP_ENTERROOM_REQUEST,d[o.ACCEPT]=i.MTP_ENTERROOM_RESULT,d)},[4,this._request.request(u)];case 2:return[2,l.sent().data]}}))}))},e.prototype.enterMtpRoomAndBet=function(e,t){return h(this,void 0,void 0,(function(){var n,s,c,u,d,l;return p(this,(function(h){switch(h.label){case 0:return[4,this.bridge.updateGameMode(t?a.demo:a.normal)];case 1:return h.sent(),n=e.applicationId||this.bridge.channel.type,s=e.serviceName||this.bridge.channel.name,c={applicationId:n,serviceName:s,stake:e.stake,mediaType:"application/vnd.lotsys.mtp.game.engine.room.criteria-and-bet-1+json",data:{data:e.parameters||{},betLevelId:e.betLevelId,channelId:"FDJ_WEB"}},u={method:"post",url:"".concat(r.BET,"?demoMode=").concat(Boolean(t)),eventTag:"enterMtpRoomAndBet",data:c,headers:(l={},l[o.CONTENTTYPE]=i.BETREQUEST,l[o.ACCEPT]=i.BETRESULT,l)},[4,this._requestWithToken.request(u)];case 2:return d=h.sent().data,this.bridge.emitEvent("HAS_BET",d),[2,d]}}))}))},e.prototype.createMtpBet=function(e,t){return h(this,void 0,void 0,(function(){var n,s,c,u,d,l;return p(this,(function(h){switch(h.label){case 0:return this._isMultiBet()?[2,new Promise((function(e){}))]:[4,this.bridge.updateGameMode(t?a.demo:a.normal)];case 1:return h.sent(),n=e.applicationId||this.bridge.channel.type,s=e.serviceName||this.bridge.channel.name,c={applicationId:n,serviceName:s,stake:e.stake,data:{data:e.parameters||{},roomId:e.roomId,gameSessionId:e.sessionId,channelId:"FDJ_WEB"}},u={method:"post",url:"".concat(r.BET,"?demoMode=").concat(Boolean(t)),eventTag:"createMtpBet",data:c,headers:(l={},l[o.CONTENTTYPE]=i.BETREQUEST,l[o.ACCEPT]=i.BETRESULT,l)},[4,this._requestWithToken.request(u)];case 2:return d=h.sent().data,this.bridge.emitEvent("HAS_BET",d),[2,d]}}))}))},e.prototype.updateMtpBet=function(e,t){return h(this,void 0,void 0,(function(){var n,s,c,u,d;return p(this,(function(l){switch(l.label){case 0:return[4,this.bridge.updateGameMode(t?a.demo:a.normal)];case 1:return l.sent(),n=e.applicationId||this.bridge.channel.type,s=e.serviceName||this.bridge.channel.name,c={applicationId:n,serviceName:s,data:{eventName:e.parameters.eventName,data:e.parameters||{},roomId:e.roomId,gameSessionId:e.sessionId,playerGameSessionId:e.playerGameSessionId,channelId:"FDJ_WEB"}},u={method:"put",url:"".concat(r.BET,"?demoMode=").concat(Boolean(t)),eventTag:"updateMtpBet",data:c,headers:(d={},d[o.CONTENTTYPE]=i.BETREQUEST,d[o.ACCEPT]=i.BETRESULT,d)},[4,this._requestWithToken.request(u)];case 2:return[2,l.sent().data]}}))}))},e.prototype.createNotificationsChannel=function(e){return h(this,void 0,void 0,(function(){var t;return p(this,(function(n){switch(n.label){case 0:return t=this.bridge.configuration.paths.push[this.bridge.channel.hostKey]||this.bridge.configuration.paths.push[""],e.hostName=e.hostName||t.hostName,e.port=e.port||t.port,e.secure=e.secure||t.secure,[4,(0,l.loadScript)(t.libPath)];case 1:return n.sent(),[4,window.pushClient.initializePush()];case 2:return[2,n.sent().createChannel(e)]}}))}))},e.prototype._itgBetMediaType=function(){return h(this,void 0,void 0,(function(){return p(this,(function(e){switch(e.label){case 0:return[4,this.bridge.getCurrentGameConfiguration()];case 1:return[2,e.sent().betMode]}}))}))},e.prototype._getHeader=function(e,t){var n=e[t]||e[t.toLowerCase()];return n&&(n=n.split(";")[0]),n},e.prototype._handleResponseErrors=function(e){return h(this,void 0,void 0,(function(){var t;return p(this,(function(n){if(t={code:"default"},!e.response)throw this.bridge.channel.emitRequestErrorTag(e.config,{data:{},status:-1,headers:{}}),t;if(this.bridge.channel.emitRequestErrorTag(e.config,e.response),401===e.response.status)return[2,this._retryOn401(e.config)];if(!e.response.headers)throw t;if(this._getHeader(e.response.headers,o.CONTENTTYPE)!==i.ERROR)throw t;if(!e.response.data)throw t;throw e.response.data}))}))},e.prototype._retryOn401=function(e){return h(this,void 0,void 0,(function(){var t,n,i,r;return p(this,(function(o){switch(o.label){case 0:if(t={code:"unauthorized"},void 0!==e.retries){if(e.retries>=1)throw t;e.retries++}else e.retries=1;return[4,this.bridge.getGameMode()];case 1:if(n=o.sent(),!Object.values(a).includes(n))throw t;return[4,this.bridge.updateGameMode(n,!0)];case 2:return o.sent(),e.headers["replay-token"]?(i=e.headers,r="replay-token",[4,this.getReplayProtectionToken()]):[3,4];case 3:i[r]=o.sent(),o.label=4;case 4:return[2,this._request.request(e)]}}))}))},e.prototype.mockAddMTR=function(e,t,n){return h(this,void 0,void 0,(function(){var a,i,r;return p(this,(function(s){switch(s.label){case 0:return n.unshift(null),a=n.join("&elements="),[4,this.getMtrModel({applicationId:e,serviceName:t})];case 1:return i=s.sent(),[4,this._request.post("".concat(this.bridge.mocksConfiguration.path,"/add?gameModelId=").concat(i.data.gmid).concat(a),{headers:(r={},r[o.CONTENTTYPE]="application/vnd.lotsys.xs.motors.enveloppe.base-1+json",r)})];case 2:return s.sent(),[2]}}))}))},e.prototype.mockResetMTR=function(e,t){return h(this,void 0,void 0,(function(){var n,a;return p(this,(function(i){switch(i.label){case 0:return[4,this.getMtrModel({applicationId:e,serviceName:t})];case 1:return n=i.sent(),[4,this._request.get("".concat(this.bridge.mocksConfiguration.path,"/reset?gameModelId=").concat(n.data.gmid),{headers:(a={},a[o.CONTENTTYPE]="application/vnd.lotsys.xs.motors.enveloppe.base-1+json",a)})];case 2:return i.sent(),[2]}}))}))},e.prototype.mockAddITG=function(e,t){return h(this,void 0,void 0,(function(){var e;return p(this,(function(n){switch(n.label){case 0:return[4,this._request.post("".concat(this.bridge.mocksConfiguration.path,"/draws"),t,{headers:(e={},e[o.CONTENTTYPE]="application/vnd.fgs.itg.mock.draw.summary-1+json",e)})];case 1:return n.sent(),[2]}}))}))},e.prototype.mockGetITG=function(e){return h(this,void 0,void 0,(function(){var e;return p(this,(function(t){switch(t.label){case 0:return[4,this._request.get("".concat(this.bridge.mocksConfiguration.path,"/draws"),{headers:(e={},e[o.CONTENTTYPE]="application/vnd.fgs.itg.mock.draw.summary.list-1+json",e)})];case 1:return[2,t.sent()]}}))}))},e.prototype.mockResetITG=function(e){return h(this,void 0,void 0,(function(){return p(this,(function(e){switch(e.label){case 0:return[4,this._request.delete("".concat(this.bridge.mocksConfiguration.path,"/draws"))];case 1:return e.sent(),[2]}}))}))},e.prototype.mockResetAllITG=function(e){return h(this,void 0,void 0,(function(){return p(this,(function(e){switch(e.label){case 0:return[4,this._request.delete("".concat(this.bridge.mocksConfiguration.path,"/draws/all"))];case 1:return e.sent(),[2]}}))}))},e.prototype._isMultiBet=function(){var e=new Date;return this._lastBetDate&&e.getTime()-this._lastBetDate.getTime()<(this._configuration.multiBetDelay?this._configuration.multiBetDelay:3500)?(this.bridge.emitEvent("TAG",{eventType:"error",event:"multibet-occurence"}),!0):(this._lastBetDate=e,!1)},e}();t.default=T},"./src/tools/token-store.ts":function(e,t,n){n.r(t),n.d(t,{TokenStore:function(){return a}});var a=function(){function e(e){this.tokenGetter=e,this.list=[]}return e.prototype.get=function(){return e=this,t=void 0,a=function(){return function(e,t){var n,a,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,a&&(i=2&r[0]?a.return:r[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,r[1])).done)return i;switch(a=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,a=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],a=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}(this,(function(e){switch(e.label){case 0:return this.list.length?[2,this.list.shift()]:[4,this.tokenGetter()];case 1:return[2,e.sent()]}}))},new((n=void 0)||(n=Promise))((function(i,r){function o(e){try{c(a.next(e))}catch(e){r(e)}}function s(e){try{c(a.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}c((a=a.apply(e,t||[])).next())}));var e,t,n,a},e.prototype.add=function(e){this.list.push(e)},e}()}}]);