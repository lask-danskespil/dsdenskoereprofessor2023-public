/*! For license information please see platform-gdk.js.LICENSE.txt */
"use strict";(self.webpackChunkfalcon=self.webpackChunkfalcon||[]).push([["platforms/platform-gdk"],{"./src/platforms/platform-gdk.ts":function(e,t,n){n.r(t),n.d(t,{EHeader:function(){return i},EItgBetMode:function(){return a},EMediaTypes:function(){return r},EPath:function(){return o}});var r,o,i,a,s=n("./node_modules/axios/index.js"),c=n.n(s),u=n("./src/falcon-game-bridge.ts"),d=n("./src/tools/tools.ts"),h=n("./src/typings/common.ts"),l=n("./src/tools/token-store.ts"),p=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},m=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};!function(e){e.BETANDCLAIM="application/vnd.lotsys.itg.ticket.betManualClaim-1+json",e.AUTOCLAIM="application/vnd.lotsys.itg.ticket.betAutoClaim-1+json"}(r||(r={})),function(e){e.REPLAYPROTECTION="/token",e.ITFSESSION="/session",e.GETSTATE="/state",e.GAMECONFIGURATION="/gameConfig"}(o||(o={})),function(e){e.CONTENTTYPE="Content-Type",e.ACCEPT="Accept",e.TOKEN="replay-token",e.ASK_TOKEN="replay-token-generate",e.GENERATED_TOKEN="replay-token-generated"}(i||(i={})),function(e){e.AUTO="BET_AUTO_CLAIM",e.MANUAL="BET_MANUAL_CLAIM"}(a||(a={}));var f=function(){function e(e){var t=this;this.bridge=e,this.ticketsMap={},this.masksMap={},this._configuration=e.configuration,this._tokens=new l.TokenStore((function(){return t.getReplayProtectionToken()})),this._request=c().create({baseURL:this._configuration.paths.applications.GDK}),this._request.interceptors.response.use((function(e){return e}),(function(e){return t._handleResponseErrors(e)})),this._requestWithToken=c().create({baseURL:this._configuration.paths.applications.GDK}),this._requestWithToken.interceptors.request.use((function(e){return p(t,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return e.headers[i.ASK_TOKEN]=!0,t=e.headers,n=i.TOKEN,[4,this._tokens.get()];case 1:return t[n]=r.sent(),[2,e]}}))}))}),(function(e){throw e})),this._requestWithToken.interceptors.response.use((function(e){return e&&e.headers&&e.headers[i.GENERATED_TOKEN]&&t._tokens.add(e.headers[i.GENERATED_TOKEN]),e}),(function(e){return t._handleResponseErrors(e)}))}return e.prototype.getReplayProtectionToken=function(){return p(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,this._request.post(o.REPLAYPROTECTION,{})];case 1:return[2,e.sent().data.value]}}))}))},e.prototype.getState=function(){return p(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,this._request.get(o.GETSTATE)];case 1:return[2,e.sent().data]}}))}))},e.prototype.createSession=function(e,t){return void 0===t&&(t=!1),p(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return e=e||{provider:this.bridge.channel.lotteryCode,state:"dummy_state",value:"dummy_value"},n={demoMode:t,lottery:e.provider,state:e.state,token:e.value},[4,this._request.post(o.ITFSESSION,n)];case 1:return[2,r.sent().data]}}))}))},e.prototype.getCurrentGameConfig=function(e,t){return p(this,void 0,void 0,(function(){var e,t;return m(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,5]),[4,this._request.get(o.GAMECONFIGURATION)];case 1:return e=n.sent().data,[3,5];case 2:return n.sent(),console.log("no response from getGameConfiguration service, loading conf from disk"),t=d.loadJSON,[4,this.bridge.getPaths()];case 3:return[4,t.apply(void 0,[n.sent().configPath])];case 4:return e=n.sent(),[3,5];case 5:return[2,e]}}))}))},e.prototype.getCompatibility=function(){return p(this,void 0,void 0,(function(){return m(this,(function(e){return[2,[]]}))}))},e.prototype.getGames=function(){return p(this,void 0,void 0,(function(){return m(this,(function(e){return[2,[]]}))}))},e.prototype.getPlayersInfo=function(e,t){return p(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,this._request.get("/players?playersIds=".concat(e.join(",")))];case 1:return[2,t.sent().data]}}))}))},e.prototype.getCurrentPlayerInfo=function(e){return p(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return e=e||this.bridge.channel.lotteryCode,[4,this._request.get("/player")];case 1:return[2,t.sent().data]}}))}))},e.prototype.getPlayerCurrency=function(e){return p(this,void 0,void 0,(function(){return m(this,(function(e){return[2,[{balance:{currency:"XTK",value:Math.floor(1e4*Math.random())},playerId:"",restrictions:{applicationId:"mtp",serviceName:"any"},type:h.ECurrencyPurseType.GIFT,validFrom:"",validTo:""},{balance:{currency:"XTK",value:Math.floor(1e4*Math.random())},playerId:"",restrictions:{applicationId:"mtp",serviceName:"any"},type:h.ECurrencyPurseType.DEFAULT,validFrom:"",validTo:""}]]}))}))},e.prototype.getAvatarUrl=function(e){return"default"},e.prototype.getJackpotInformation=function(e){return void 0===e&&(e={}),p(this,void 0,void 0,(function(){return m(this,(function(e){throw new Error("Old jackpot is no more supported on 2.9+ / 3.5+")}))}))},e.prototype.getJackpotConfiguration=function(e){return p(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,this._request.get("/jackpots/".concat(e))];case 1:return[2,t.sent().data]}}))}))},e.prototype.getItgModel=function(e){return p(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return e=e||this.bridge.channel.name,[4,this._request.get("/itf/game/model/ITG/".concat(e))];case 1:return[2,t.sent().data]}}))}))},e.prototype.getItgTicket=function(e,t){return void 0===t&&(t=!1),p(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return[4,this.bridge.updateGameMode(t?u.EGameMode.demo:u.EGameMode.normal)];case 1:return r.sent(),[4,this._requestWithToken.get("/itg/tickets/".concat(e))];case 2:return[2,(n=r.sent().data).length?n[0]:null]}}))}))},e.prototype.getItgTickets=function(e,t){return void 0===t&&(t=!1),p(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return[4,this.itgBetMediaType()];case 1:return n.sent()!==a.MANUAL?[2,[]]:[4,this.bridge.updateGameMode(t?u.EGameMode.demo:u.EGameMode.normal)];case 2:return n.sent(),e=e||this.bridge.channel.name,[4,this._requestWithToken.get("/itg/tickets?demoMode=".concat(t,"&ticketStatus=OPENED&gameCode=").concat(e))];case 3:return[2,n.sent().data]}}))}))},e.prototype.createITGBet=function(e){return p(this,void 0,void 0,(function(){var t,n,o,i,a,s;return m(this,(function(c){switch(c.label){case 0:return this._isMultiBet()?[2,new Promise((function(e){}))]:[4,this.bridge.updateGameMode(e.demo?u.EGameMode.demo:u.EGameMode.normal)];case 1:return c.sent(),[4,this.itgBetMediaType()];case 2:return t=c.sent(),n=e.applicationId||this.bridge.channel.type,o=(e.serviceName||this.bridge.channel.name).toLowerCase(),[4,this._requestWithToken.post("/itg/".concat(e.serviceName,"/tickets?demoMode=").concat(Boolean(e.demo)),{applicationId:n,serviceName:o,mediaType:t,stake:e.stake,data:e.revelationData||e.eventReference?{revelationData:e.revelationData,eventReference:e.eventReference}:void 0})];case 3:return i=c.sent().data,t===r.BETANDCLAIM?[3,5]:(delete(a=JSON.parse(JSON.stringify(i))).message,[4,this.bridge.channel.maskPurse({betAmount:e.stake,purseInformation:null,winAmount:a.wonAmount})]);case 4:s=c.sent(),this.bridge.displayedAmount=s,this.masksMap[i.data.id]=s.maskId,this.ticketsMap[i.data.id]=a,c.label=5;case 5:return[2,i]}}))}))},e.prototype.updateItgBet=function(e,t){return p(this,void 0,void 0,(function(){var n,r;return m(this,(function(o){switch(o.label){case 0:return[4,this.itgBetMediaType()];case 1:return o.sent()!==a.MANUAL?[2,this.ticketsMap[t]]:[4,this.bridge.updateGameMode(e.demo?u.EGameMode.demo:u.EGameMode.normal)];case 2:return o.sent(),n=e.applicationId||this.bridge.channel.type,r=e.serviceName||this.bridge.channel.name,[4,this._requestWithToken.put("/itg/".concat(e.serviceName,"/tickets/").concat(t),{applicationId:n,serviceName:r,stake:e.stake,data:{id:t,revelationData:e.revelationData}})];case 3:return[2,o.sent().data]}}))}))},e.prototype.claimItgBet=function(e,t){return p(this,void 0,void 0,(function(){var n,r,o;return m(this,(function(i){switch(i.label){case 0:return[4,this.itgBetMediaType()];case 1:return i.sent()===a.MANUAL?[3,3]:(n=this.ticketsMap[t],[4,this.bridge.channel.clearPurse(this.masksMap[t])]);case 2:return i.sent(),this.bridge.displayedAmount=null,delete this.masksMap[t],delete this.ticketsMap[t],[2,n];case 3:return[4,this.bridge.updateGameMode(e.demo?u.EGameMode.demo:u.EGameMode.normal)];case 4:return i.sent(),r=e.applicationId||this.bridge.channel.type,o=e.serviceName||this.bridge.channel.name,[4,this._requestWithToken.put("/itg/".concat(e.serviceName,"/tickets/").concat(t),{applicationId:r,serviceName:o,stake:e.stake,data:{id:t,revelationData:e.revelationData,status:"CLAIMED"}})];case 5:return[2,i.sent().data]}}))}))},e.prototype.getMtrModel=function(e,t){return void 0===t&&(t=!1),p(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return[4,this.bridge.updateGameMode(t?u.EGameMode.demo:u.EGameMode.normal)];case 1:return r.sent(),n=e.serviceName||this.bridge.channel.name,[4,this._request.get("/mtr/".concat(n,"/model?demoMode=").concat(t))];case 2:return[2,r.sent().data]}}))}))},e.prototype.getMtrSession=function(e,t,n){return void 0===t&&(t=!1),p(this,void 0,void 0,(function(){var r,o,i;return m(this,(function(a){switch(a.label){case 0:return[4,this.bridge.updateGameMode(t?u.EGameMode.demo:u.EGameMode.normal)];case 1:return a.sent(),r=e.serviceName||this.bridge.channel.name,o=["demoMode=".concat(t)],n&&o.push("gameSessionId=".concat(n)),[4,this._request.get("/mtr/".concat(r,"/session").concat(o.length?"?".concat(o.join("&")):""))];case 2:return i=a.sent().data,[2,Object.keys(i).length>0?i:void 0]}}))}))},e.prototype.createMtrBet=function(e){return p(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return this._isMultiBet()?[2,new Promise((function(e){}))]:(t=void 0!==e.demo&&e.demo,[4,this.bridge.updateGameMode(t?u.EGameMode.demo:u.EGameMode.normal)]);case 1:return r.sent(),n=e.serviceName||this.bridge.channel.name,[4,this._request.post("/mtr/".concat(n,"/bet?demoMode=").concat(t),void 0!==e.parameters.betId?e.parameters:{stake:e.stake,data:e.parameters})];case 2:return[2,r.sent().data]}}))}))},e.prototype.updateMtrBet=function(e){return p(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return t=void 0!==e.demo&&e.demo,[4,this.bridge.updateGameMode(t?u.EGameMode.demo:u.EGameMode.normal)];case 1:return r.sent(),n=e.serviceName||this.bridge.channel.name,[4,this._request.put("/mtr/".concat(n,"/bet?demoMode=").concat(t),e.parameters)];case 2:return[2,r.sent().data]}}))}))},e.prototype.getPrsTicketInfos=function(){return p(this,void 0,void 0,(function(){var e;return m(this,(function(t){switch(t.label){case 0:return e=this.bridge.channel.name,[4,this._request.request({method:"get",url:"/mtr/".concat(e,"/ticket")})];case 1:return[2,t.sent().data]}}))}))},e.prototype.getGamifContext=function(e){return p(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return t=e.serviceName||this.bridge.channel.name,[4,this._request.get("/gamif/getcontext/".concat(t))];case 1:return[2,n.sent().data]}}))}))},e.prototype.getMtpModel=function(e,t){return p(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return n=e.serviceName||this.bridge.channel.name,[4,this._request.get("/mtp/games/".concat(n,"/params?demoMode=").concat(Boolean(t)))];case 1:return[2,r.sent().data]}}))}))},e.prototype.getMtpRoom=function(e,t,n){return p(this,void 0,void 0,(function(){var r;return m(this,(function(o){switch(o.label){case 0:return r=e.serviceName||this.bridge.channel.name,[4,this._request.get("/mtp/games/".concat(r,"/rooms/").concat(t,"?demoMode=").concat(Boolean(n)))];case 1:return[2,o.sent().data]}}))}))},e.prototype.getMtpRooms=function(e,t){return p(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return n=e.serviceName||this.bridge.channel.name,[4,this._request.get("/mtp/games/".concat(n,"/rooms?demoMode=").concat(Boolean(t)))];case 1:return[2,r.sent().data]}}))}))},e.prototype.getMtpSession=function(e,t,n){return p(this,void 0,void 0,(function(){var r;return m(this,(function(o){switch(o.label){case 0:return r=e.serviceName||this.bridge.channel.name,[4,this._request.get("/mtp/games/".concat(r,"/rooms/").concat(t,"/session?demoMode=").concat(Boolean(n)))];case 1:return[2,o.sent().data]}}))}))},e.prototype.enterMtpRoom=function(e,t){return p(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return n=e.serviceName||this.bridge.channel.name,[4,this._request.put("/mtp/games/".concat(n,"/rooms?demoMode=").concat(Boolean(t)),{betLevelId:e.betLevelId})];case 1:return[2,r.sent().data]}}))}))},e.prototype.enterMtpRoomAndBet=function(e,t){return p(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return n=e.serviceName||this.bridge.channel.name,[4,this._request.post("/mtp/games/".concat(n,"/rooms/bet?demoMode=").concat(Boolean(t)),{betLevelId:e.betLevelId,amount:e.stake,data:e.parameters||{}})];case 1:return[2,r.sent().data]}}))}))},e.prototype.createMtpBet=function(e,t){return p(this,void 0,void 0,(function(){var n,r,o;return m(this,(function(i){switch(i.label){case 0:return this._isMultiBet()?[2,new Promise((function(e){}))]:[4,this.bridge.updateGameMode(t?u.EGameMode.demo:u.EGameMode.normal)];case 1:return i.sent(),n=e.applicationId||this.bridge.channel.type,r=e.serviceName||this.bridge.channel.name,[4,this._requestWithToken.post("/mtp/games/".concat(r,"/rooms/").concat(e.roomId,"/bet?demoMode=").concat(Boolean(t)),{amount:e.stake,data:e.parameters||{}})];case 2:return o=i.sent().data,this.bridge.emitEvent("HAS_BET",o),this.bridge.emitEvent("HAS_CLAIMED",{applicationId:n,serviceName:r,wonAmount:o.wonAmount,demo:Boolean(e.demo)}),[2,o]}}))}))},e.prototype.updateMtpBet=function(e,t){return p(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return[4,this.bridge.updateGameMode(t?u.EGameMode.demo:u.EGameMode.normal)];case 1:return r.sent(),n=e.serviceName||this.bridge.channel.name,[4,this._requestWithToken.put("/mtp/games/".concat(n,"/rooms/").concat(e.roomId,"/bet?demoMode=").concat(Boolean(t)),{eventName:e.parameters.eventName,playerGameSessionId:e.playerGameSessionId,data:e.parameters||{}})];case 2:return[2,r.sent().data]}}))}))},e.prototype.createNotificationsChannel=function(e){return p(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return t=this.bridge.configuration.paths.push[this.bridge.channel.hostKey]||this.bridge.configuration.paths.push[""],e.hostName=e.hostName||window.location.hostname,e.port=e.port||parseInt(window.location.port),e.secure=e.secure||t.secure,[4,(0,d.loadScript)(t.libPath)];case 1:return n.sent(),[4,window.pushClient.initializePush()];case 2:return[2,n.sent().createChannel(e)]}}))}))},e.prototype.itgBetMediaType=function(){var e;return p(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return[4,this.bridge.getCurrentGameConfiguration()];case 1:return t=n.sent(),[2,null!==(e=t.betMode)&&void 0!==e?e:t.selectedBetMode]}}))}))},e.prototype._handleResponseErrors=function(e){return p(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){if(t={code:"default"},n={code:"unauthorized"},!e.response)throw t;if(401===e.response.status)throw n;if(!e.response.headers)throw t;if(!e.response.data)throw t;throw e.response.data}))}))},e.prototype.mockAddMTR=function(e,t,n){return p(this,void 0,void 0,(function(){var r,o;return m(this,(function(i){switch(i.label){case 0:return n.unshift(null),r=n.join("&elements="),[4,this.getMtrModel({applicationId:e,serviceName:t})];case 1:return o=i.sent(),[4,this._request.post("/mtr/admin/mock?gameModelId=".concat(o.data.gmid).concat(r))];case 2:return i.sent(),[2]}}))}))},e.prototype.mockResetMTR=function(e,t){return p(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return[4,this.getMtrModel({applicationId:e,serviceName:t})];case 1:return n=r.sent(),[4,this._request.delete("/mtr/admin/mock?gameModelId=".concat(n.data.gmid))];case 2:return r.sent(),[2]}}))}))},e.prototype.mockAddITG=function(e,t){return p(this,void 0,void 0,(function(){var e,n,r,o;return m(this,(function(i){switch(i.label){case 0:for(e=[],n=0,r=t.draws;n<r.length;n++)o=r[n],e.push({rank:o.rankIndex,symbol:o.symbol});return[4,this._request.post("".concat(this.bridge.mocksConfiguration.path,"/").concat(t.lotteryGameCode),e)];case 1:return i.sent(),[2]}}))}))},e.prototype.mockGetITG=function(e,t){return p(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,this._request.get("".concat(this.bridge.mocksConfiguration.path,"/").concat(t))];case 1:return[2,e.sent()]}}))}))},e.prototype.mockResetITG=function(e,t){return p(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,this._request.delete("".concat(this.bridge.mocksConfiguration.path,"/").concat(t))];case 1:return e.sent(),[2]}}))}))},e.prototype.mockResetAllITG=function(e,t){return p(this,void 0,void 0,(function(){return m(this,(function(e){switch(e.label){case 0:return[4,this._request.delete("".concat(this.bridge.mocksConfiguration.path,"/").concat(t))];case 1:return e.sent(),[2]}}))}))},e.prototype._isMultiBet=function(){var e=new Date;return this._lastBetDate&&e.getTime()-this._lastBetDate.getTime()<(this._configuration.multiBetDelay?this._configuration.multiBetDelay:3e3)?(this.bridge.emitEvent("TAG",{eventType:"error",event:"multibet-occurence"}),!0):(this._lastBetDate=e,!1)},e}();t.default=f},"./src/tools/token-store.ts":function(e,t,n){n.r(t),n.d(t,{TokenStore:function(){return r}});var r=function(){function e(e){this.tokenGetter=e,this.list=[]}return e.prototype.get=function(){return e=this,t=void 0,r=function(){return function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}(this,(function(e){switch(e.label){case 0:return this.list.length?[2,this.list.shift()]:[4,this.tokenGetter()];case 1:return[2,e.sent()]}}))},new((n=void 0)||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}));var e,t,n,r},e.prototype.add=function(e){this.list.push(e)},e}()}}]);