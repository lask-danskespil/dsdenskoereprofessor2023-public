"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ThemePacker = void 0;
const path_1 = require("path");
const fs_extra_1 = require("fs-extra");
const aModulePacker_1 = require("./aModulePacker");
const helpers_1 = require("../../tools/helpers");
/**
 * Pack theme.
 */
class ThemePacker extends aModulePacker_1.AModulePacker {
    /**
     * ThemePacker constructor.
     * @param gameDirectory root path of the game to pack.
     * @param deliveryDirectory path for the output file.
     * @param deliveryVersion version of the applet.
     * @param gameConfiguration configuration of the game.
     * @param themeName name of the theme to pack;
     */
    constructor(gameDirectory, deliveryDirectory, deliveryVersion, gameConfiguration, themeName) {
        super(gameDirectory, deliveryDirectory, deliveryVersion, gameConfiguration);
        this._themeName = themeName;
        this._themeSourceDirectory = (0, path_1.resolve)(this._gameDirectory, "assets", this._gameConfiguration.getThemePath(this._themeName));
        this._themeDeliveryDirectory = (0, path_1.resolve)(this._deliveryDirectory, "assets", this._gameConfiguration.getThemePath(this._themeName));
    }
    /**
     * Prepare to pack the theme.
     * @returns an IFilesList for files to pack when done.
     */
    async preparePack() {
        // Copy folder and update files.json
        (0, fs_extra_1.copySync)(this._themeSourceDirectory, this._themeDeliveryDirectory);
        this._appendVersionToThemeFile();
        return (0, helpers_1.getFullFilesList)(this._themeDeliveryDirectory);
    }
    /**
     * @returns the packer name.
     */
    _getPackerName() {
        return `theme ${this._themeName}`;
    }
    _appendVersionToThemeFile() {
        const filePath = (0, path_1.join)(this._themeDeliveryDirectory, "files.json");
        const fileContent = (0, fs_extra_1.readJSONSync)(filePath);
        fileContent.version = this._deliveryVersion;
        (0, fs_extra_1.writeJSONSync)(filePath, fileContent);
    }
}
exports.ThemePacker = ThemePacker;
//# sourceMappingURL=theme.js.map